import React, { useState, useEffect } from 'react';
import Modal from './Modal';
import gameHandler from './functions/GameHandler';
import fetchRandomHamster from './functions/FetchRandomHamster';
import './Battle.css';


const Battle = ()=>{

    const randomHamster = '/api/hamsters/random';
    const [hamsterOne, setHamsterOne] = useState(null);
    const [hamsterTwo, setHamsterTwo] = useState(null);
    const [winner, setWinner] = useState(null);
    const [showModal, setShowModal] = useState(false);

    const hamsterName = !showModal ? 'hamster-name z-index' : 'hamster-name';


    
    

    useEffect(()=>{

        fetchRandomHamster(randomHamster, setHamsterOne)
        fetchRandomHamster(randomHamster, setHamsterTwo)

    },[])


    const hideModal = ()=>{
        setShowModal(false);
        fetchRandomHamster(randomHamster, setHamsterOne)
        fetchRandomHamster(randomHamster, setHamsterTwo)
    }

    const handleWinner = (w) => {
        setWinner(w);
        setShowModal(true);
        if(w.id === hamsterOne.id){
            gameHandler(w.id, hamsterTwo.id)

        }
        if(w.id === hamsterTwo.id){
            gameHandler(w.id, hamsterOne.id)

        }

    }

    return(
        <div className="content">

            {showModal
            ?<>
            <Modal show={showModal} handleClose={hideModal}>
                <header className="winner-name">
                    <h1>The winner is {winner.name}!</h1>
                    <svg width="200" height="180" viewBox="0 0 869 762" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M509.243 266.707L615.578 259.889L569.157 348.849L568.305 350.481L570.076 350.985L642.239 371.544L779.649 410.69L648.96 428.26L580.051 437.524L578.021 437.797L578.894 439.65L624.309 536.047L516.612 511.934L514.635 511.491L514.789 513.511L519.732 578.634L529.144 702.635L461.384 591.101L425.878 532.658L424.794 530.875L423.449 532.47L335.907 636.274L325.218 494.965L325.077 493.093L323.282 493.644L257.915 513.728L133.166 552.057L222.593 465.641L269.559 420.257L271.15 418.719L269.132 417.811L169.485 372.965L270.809 322.427L272.533 321.567L271.277 320.107L225.934 267.396L139.837 167.308L262.538 225.099L327.07 255.494L328.552 256.192L329.117 254.654L365.834 154.679L428.415 232.808L429.658 234.361L430.809 232.738L468.153 180.077L539.039 80.1176L518.492 201.185L507.668 264.959L507.35 266.828L509.243 266.707Z" fill="#F2D5CE" stroke="#2A4759" strokeWidth="3"/>
<rect x="393.5" y="405.5" width="53" height="144" fill="#F2AF5C" stroke="#2A4759" strokeWidth="3"/>
<path d="M295.412 594.5L320.556 543.5H513.473L545.296 594.5H295.412Z" fill="#2A4759" stroke="#2A4759" strokeWidth="3"/>
<path d="M450.5 325.306V298.317C450.659 298.23 450.842 298.131 451.048 298.021C451.903 297.562 453.151 296.907 454.714 296.125C457.842 294.56 462.225 292.494 467.244 290.487C477.351 286.444 489.783 282.744 499.731 283.633C521.524 285.579 538.874 290.395 548.083 309.473C555.08 323.968 557.209 336.409 554.118 352.133C551.687 364.497 543.992 375.975 533.639 386.283C523.296 396.58 510.401 405.608 497.765 413.077C485.136 420.542 472.811 426.423 463.64 430.438C459.056 432.446 455.264 433.985 452.62 435.022C451.799 435.344 451.089 435.617 450.5 435.841V407.395C450.57 407.363 450.643 407.328 450.721 407.292C451.431 406.958 452.469 406.465 453.783 405.826C456.411 404.548 460.144 402.685 464.574 400.342C473.429 395.658 485.087 389.047 496.261 381.347C507.415 373.662 518.186 364.827 525.183 355.677C532.16 346.555 535.649 336.743 531.358 327.393C528.294 320.717 526.277 316.707 523.109 313.896C519.937 311.082 515.731 309.573 508.735 307.389C503.297 305.691 496.75 306.163 490.138 307.69C483.496 309.224 476.618 311.864 470.424 314.682C464.223 317.503 458.668 320.52 454.664 322.83C452.982 323.801 451.571 324.649 450.5 325.306Z" fill="#F2AF5C" stroke="#2A4759" strokeWidth="3"/>
<path d="M387.5 325.306V298.317C387.341 298.23 387.158 298.131 386.952 298.021C386.097 297.562 384.849 296.907 383.286 296.125C380.158 294.56 375.775 292.494 370.756 290.487C360.649 286.444 348.217 282.744 338.269 283.633C316.476 285.579 299.126 290.395 289.917 309.473C282.92 323.968 280.791 336.409 283.882 352.133C286.313 364.497 294.008 375.975 304.361 386.283C314.704 396.58 327.599 405.608 340.235 413.077C352.864 420.542 365.189 426.423 374.36 430.438C378.944 432.446 382.736 433.985 385.38 435.022C386.201 435.344 386.911 435.617 387.5 435.841V407.395C387.43 407.363 387.357 407.328 387.279 407.292C386.569 406.958 385.531 406.465 384.217 405.826C381.589 404.548 377.856 402.685 373.426 400.342C364.571 395.658 352.913 389.047 341.739 381.347C330.585 373.662 319.814 364.827 312.817 355.677C305.84 346.555 302.351 336.743 306.642 327.393C309.706 320.717 311.723 316.707 314.891 313.896C318.063 311.082 322.269 309.573 329.265 307.389C334.703 305.691 341.25 306.163 347.862 307.69C354.504 309.224 361.382 311.864 367.576 314.682C373.777 317.503 379.332 320.52 383.336 322.83C385.018 323.801 386.429 324.649 387.5 325.306Z" fill="#F2AF5C" stroke="#2A4759" strokeWidth="3"/>
<path d="M350.95 427.37L336.64 267.5H493.905L484.034 427.405C484.012 427.43 483.99 427.456 483.966 427.483C483.707 427.782 483.321 428.222 482.818 428.784C481.811 429.909 480.336 431.52 478.471 433.459C474.737 437.337 469.447 442.515 463.217 447.721C456.982 452.93 449.834 458.143 442.386 462.11C434.927 466.083 427.255 468.759 419.95 469.001C412.252 469.255 404.08 466.835 396.084 462.958C388.099 459.087 380.384 453.81 373.631 448.472C366.883 443.137 361.125 437.765 357.054 433.725C355.019 431.706 353.408 430.022 352.307 428.845C351.757 428.257 351.334 427.795 351.05 427.482C351.015 427.442 350.981 427.405 350.95 427.37Z" fill="#F2AF5C" stroke="#2A4759" strokeWidth="3"/>
<path d="M377.819 328.588V301.024L415.637 296L452.362 301.024L453.317 314.331V320.848V327.366V329.538L454 334.427V335.241V342.438V345.696L453.317 349.363L452.362 352.35L451.133 356.152L449.358 359.139L447.31 361.855L444.443 364.163L441.03 366.2L437.344 368.372L433.112 370.816L429.152 372.989L425.739 375.026L421.507 377.062L417.548 379.235L415.227 381L412.906 379.235L408.947 377.062L402.803 373.668L396.113 369.866L390.926 367.014L386.83 364.163L383.417 361.176L380.823 357.781L379.321 354.93L377.819 351.264L377 346.783V341.487V335.241L377.819 328.588Z" fill="#F2AF5C" stroke="#2A4759" strokeWidth="3"/>
<path d="M382.723 329.754V305.433L416.121 301L448.553 305.433L449.397 317.174V322.925V328.676V330.593L450 334.906V335.625V341.974V344.85L449.397 348.085L448.553 350.72L447.468 354.075L445.901 356.711L444.092 359.107L441.56 361.144L438.546 362.941L435.291 364.858L431.553 367.014L428.057 368.931L425.043 370.728L421.305 372.526L417.809 374.442L415.759 376L413.709 374.442L410.213 372.526L404.787 369.53L398.879 366.176L394.298 363.66L390.681 361.144L387.667 358.508L385.376 355.513L384.05 352.997L382.723 349.762L382 345.808V341.136V335.625L382.723 329.754Z" fill="#658CBF" stroke="#2A4759" strokeWidth="3"/>
<path d="M417.064 315.2C418.13 315.2 419.026 315.584 419.752 316.352C420.477 317.077 420.84 317.995 420.84 319.104V356.096C420.84 357.205 420.434 358.144 419.624 358.912C418.813 359.637 417.81 360 416.616 360C415.421 360 414.44 359.637 413.672 358.912C412.904 358.144 412.52 357.205 412.52 356.096V325.76L408.552 328.192C407.912 328.576 407.229 328.768 406.504 328.768C405.437 328.768 404.52 328.363 403.752 327.552C403.026 326.741 402.664 325.845 402.664 324.864C402.664 324.181 402.834 323.541 403.176 322.944C403.56 322.347 404.05 321.877 404.648 321.536L414.312 315.776C415.037 315.392 415.954 315.2 417.064 315.2Z" fill="#F2AF5C"/>
<path d="M419.752 316.352L417.571 318.412L417.6 318.443L417.63 318.473L419.752 316.352ZM419.624 358.912L421.624 361.148L421.656 361.119L421.687 361.09L419.624 358.912ZM413.672 358.912L411.55 361.033L411.581 361.064L411.612 361.093L413.672 358.912ZM412.52 325.76H415.52V320.403L410.952 323.202L412.52 325.76ZM408.552 328.192L410.095 330.764L410.107 330.757L410.119 330.75L408.552 328.192ZM403.752 327.552L401.516 329.552L401.545 329.584L401.574 329.615L403.752 327.552ZM403.176 322.944L400.652 321.322L400.61 321.388L400.571 321.456L403.176 322.944ZM404.648 321.536L406.136 324.141L406.16 324.127L406.184 324.113L404.648 321.536ZM414.312 315.776L412.908 313.125L412.841 313.16L412.776 313.199L414.312 315.776ZM417.064 318.2C417.314 318.2 417.418 318.251 417.571 318.412L421.933 314.292C420.634 312.917 418.947 312.2 417.064 312.2V318.2ZM417.63 318.473C417.745 318.587 417.84 318.719 417.84 319.104H423.84C423.84 317.271 423.21 315.567 421.873 314.231L417.63 318.473ZM417.84 319.104V356.096H423.84V319.104H417.84ZM417.84 356.096C417.84 356.375 417.778 356.528 417.561 356.734L421.687 361.09C423.091 359.76 423.84 358.035 423.84 356.096H417.84ZM417.623 356.676C417.419 356.86 417.151 357 416.616 357V363C418.47 363 420.208 362.415 421.624 361.148L417.623 356.676ZM416.616 357C416.079 357 415.869 356.86 415.732 356.731L411.612 361.093C413.011 362.414 414.763 363 416.616 363V357ZM415.793 356.791C415.601 356.599 415.52 356.429 415.52 356.096H409.52C409.52 357.982 410.206 359.689 411.55 361.033L415.793 356.791ZM415.52 356.096V325.76H409.52V356.096H415.52ZM410.952 323.202L406.984 325.634L410.119 330.75L414.087 328.318L410.952 323.202ZM407.008 325.62C406.82 325.732 406.669 325.768 406.504 325.768V331.768C407.789 331.768 409.003 331.42 410.095 330.764L407.008 325.62ZM406.504 325.768C406.303 325.768 406.161 325.733 405.93 325.489L401.574 329.615C402.879 330.992 404.571 331.768 406.504 331.768V325.768ZM405.987 325.552C405.697 325.227 405.664 325.025 405.664 324.864H399.664C399.664 326.665 400.356 328.256 401.516 329.552L405.987 325.552ZM405.664 324.864C405.664 324.708 405.696 324.58 405.78 324.432L400.571 321.456C399.973 322.503 399.664 323.655 399.664 324.864H405.664ZM405.699 324.566C405.831 324.361 405.972 324.235 406.136 324.141L403.159 318.931C402.129 319.52 401.289 320.332 400.652 321.322L405.699 324.566ZM406.184 324.113L415.848 318.353L412.776 313.199L403.112 318.959L406.184 324.113ZM415.715 318.427C415.883 318.339 416.279 318.2 417.064 318.2V312.2C415.63 312.2 414.191 312.445 412.908 313.125L415.715 318.427Z" fill="#2A4759"/>
</svg>
                </header>
                <img className="winner-hamster" src={`/assets/${winner.imgName}`} alt={winner.imgName}/>
                <p>{winner.name} has won {winner.wins} out of {winner.games} battles.</p>
            </Modal>
            </>
            :null
            }

            <h1>Battle</h1>
            <p className="preamble">
                It's battle time! Choose the cutest hamster by voting below. You have the power to select the winner!
            </p>
            <section className="contestants">
                <article className="hamster-display">
                        {hamsterOne
                        ?<>
                        <div className={hamsterName}><h2>{hamsterOne.name}</h2></div>
                        <img className="battle-hamster" src={`/assets/${hamsterOne.imgName}`} alt={hamsterOne.imgName}/>
                        <button className="bt-vote" onClick={()=>handleWinner(hamsterOne)}>Vote for {hamsterOne.name}</button>
                        </>
                        : 'no data'}
                </article>
                <article className="hamster-display">
                        {hamsterTwo
                        ?<>
                        <div className={hamsterName}><h2>{hamsterTwo.name}</h2></div>
                        <img className="battle-hamster" src={`/assets/${hamsterTwo.imgName}`} alt={hamsterTwo.imgName}/>
                        <button className="bt-vote" onClick={()=>handleWinner(hamsterTwo)}>Vote for {hamsterTwo.name}</button>
                        </>
                        : 'no data'}

                </article>
            </section>

        </div>
    )
}
export default Battle;